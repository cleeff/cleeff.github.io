(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{102:function(e,t){},106:function(e,t,r){"use strict";r.r(t);var n,a=r(0),l=r.n(a),i=r(49),o=r.n(i),s=(r(58),r(1)),u=r.n(s),c=r(4),p=r(5),f=r(12),h=r(16),v=r(14),d=r(22),m=r(15),y=r(3),g=r(51),k=r(6),b=r(33),w=r(10),x=r.n(w),S=(r(72),11),E=new b.InferenceSession,j="./11_2w4_2000.onnx",O=!1,C="",_=!0;function G(){return M.apply(this,arguments)}function M(){return(M=Object(y.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.loadModel(j);case 2:O=!0;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return e+S*t}function R(e){var t=e%S;return[t,(e-t)/S]}function H(e){if("red-bottom"===e)return x.a.range(S*(S-1),S*S);if("red-top"===e)return x.a.range(0,S);if("blue-left"===e)return x.a.range(0,S*S,S);if("blue-right"===e)return x.a.range(S-1,S*S,S);var t=function(e){var t=R(e),r=Object(m.a)(t,2),n=r[0],a=r[1],l=[];return 0!==n&&l.push(A(n-1,a)),0!==n&&a!==S-1&&l.push(A(n-1,a+1)),0!==a&&l.push(A(n,a-1)),a!==S-1&&l.push(A(n,a+1)),n!==S-1&&0!==a&&l.push(A(n+1,a-1)),n!==S-1&&l.push(A(n+1,a)),l}(e),r=R(e),n=Object(m.a)(r,2),a=n[0],l=n[1];return 0===a&&t.push("blue-left"),a===S-1&&t.push("blue-right"),0===l&&t.push("red-top"),l===S-1&&t.push("red-bottom"),t}function W(e){var t=["red-top","blue-left"],r=["red-bottom","blue-right"];for(var n in x.a.range(2))for(var a=r[n],l=[t[n]],i=new Set;l.length>0;){var o,s=l.pop(),u=Object(d.a)(H(s));try{for(u.s();!(o=u.n()).done;){var c=o.value;if(c===a)return!0;"string"!==typeof c&&(e[c]!==n.toString()||i.has(c)||(l.push(c),i.add(c)))}}catch(p){u.e(p)}finally{u.f()}}return!1}var q=function(e){Object(h.a)(r,e);var t=Object(v.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state={showRatings:e.initial},n.handleClick=n.handleClick.bind(Object(f.a)(n)),n}return Object(p.a)(r,[{key:"handleClick",value:function(){this.props.toggle(!this.state.showRatings),this.setState((function(e){return{showRatings:!e.showRatings}}))}},{key:"render",value:function(){return l.a.createElement("button",{onClick:this.handleClick},this.state.showRatings?"Hide Ratings":"Show Ratings")}}]),r}(l.a.Component),D={setup:function(){return{cells:Array(S*S).fill(null),connected_sets:[[],[]],connected_set_rows:[[],[]],winner:null,model_output:Array(S*S).fill(null),model_display:Array(S*S).fill("")}},moves:{clickCell:function(e,t,r){if(1==e.cells.reduce((function(e,t){return e+(t?1:0)}),0)&&"0"==e.cells[r])_=!_,C="Switched!";else{var n=t.currentPlayer;_||(n="0"===t.currentPlayer?"1":"0"),e.cells[r]=n;var a=W(e.cells);e.last_move=r,a&&(e.winner=n)}}},endIf:function(e,t){if(null!==e.winner)return{winner:e.winner}},turn:{moveLimit:1},ai:{enumerate:function(e,t){for(var r=[],n=0;n<S*S;n++)null===e.cells[n]&&r.push({move:"clickCell",args:[n]});return r}}};function P(e,t,r,n){var a="0"===r?"1":"0";if(W(e))return"0"===r?[-1,null]:[1,null];if(0===t)return[0,null];if("0"===r){for(var l=-10,i=null,o=0;o<S*S;o++)if(null===e[o]){e[o]=r;var s=P(e,t-1,a,n);if(e[o]=null,s[0]>l&&(l=s[0],i=o),l>=1)return[l,i];if(r!==n&&0===l)return[l,i]}return[l,i]}for(var u=10,c=null,p=0;p<S*S;p++)if(null===e[p]){e[p]=r;var f=P(e,t-1,a,n);if(e[p]=null,f[0]<u){if(c=p,(u=f[0])<=-1)return[u,c];if(r!==n&&0===u)return[u,c]}}return[u,c]}function B(e,t,r,n){return[-1,S].includes(e)&&[-1,S].includes(t)?(r.push(0),!0):!(![-1,S].includes(e)&&![-1,S].includes(t))&&([-1,S].includes(e)?r.push(n?1:0):r.push(n?0:1),!0)}var T=function(e){Object(h.a)(r,e);var t=Object(v.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).setDisplayRatings=n.setDisplayRatings.bind(Object(f.a)(n)),n.state={display_ratings:!1},n}return Object(p.a)(r,[{key:"findSureWinMove",value:function(e,t){for(var r=0,n=[1,3];r<n.length;r++){var a=P(e,n[r],t,t);if("0"===t){if(a[0]>0)return a[1]}else if(a[0]<0)return a[1]}return null}},{key:"onClick",value:function(e){var t=this;if(this.isActive(e)){var r=_?"0":"1",a=_?"1":"0",l=Array.from(this.props.G.cells);if(l[e]=r,this.props.moves.clickCell(e),!W(l)){var i=this.findSureWinMove(l,a);if(null===i)this.runModel(l).then((function(l){for(var i=t.props.G.cells.reduce((function(e,t){return e+(t?1:0)}),0),o=-1,s=0;s<S*S;s++)(i<=1||null===t.props.G.cells[s])&&(-1===o||l[s]>n)&&(o=s,n=l[s]);for(var u=0;u<S*S;u++){if(i<=1||null===t.props.G.cells[u])Math.pow(2,l[u]-n)}for(var c=0;c<S*S;c++)if(i<=1||null===t.props.G.cells[c]){Math.pow(2,l[c]-n);t.props.G.model_display[c]=l[c].toFixed(1)}else t.props.G.model_display[c]="";var p=Array.from(t.props.G.cells);p[e]=r,p[o]=a;var f=t.findSureWinMove(p,r);null!==f&&(console.log("Player can surely win with the suggested move",o,"Moving to the sure win move instead."),o=f),t.props.moves.clickCell(o)}));else{console.log("Found sure win move",i),this.props.moves.clickCell(i);for(var o=0;o<S*S;o++)this.props.G.model_display[o]=""}}}}},{key:"setDisplayRatings",value:function(e){this.setState({display_ratings:e})}},{key:"evalModel",value:function(){var e=Object(y.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[new b.Tensor(new Float32Array(t),"float32",[1,2,S+2,S+2])],e.next=3,E.run(r);case 3:return n=e.sent,e.abrupt("return",n.values().next().value.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"runModel",value:function(){var e=Object(y.a)(u.a.mark((function e(t){var r,n,a,l,i,o,s,c,p,f,h,v,d,m,y,g,k,b,w,x,E,j,M,R,H;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C="waiting for agent to move...",O){e.next=5;break}return e.next=5,G();case 5:if(r=[],_){for(n=-1;n<S+1;n++)for(a=-1;a<S+1;a++)B(n,a,r,1)||(l=A(n,a),r.push("1"===t[l]?1:0));for(i=-1;i<S+1;i++)for(o=-1;o<S+1;o++)B(i,o,r,0)||(s=A(i,o),r.push("0"===t[s]?1:0))}else{for(c=-1;c<S+1;c++)for(p=-1;p<S+1;p++)B(p,c,r,0)||(f=A(p,c),r.push("0"===t[f]?1:0));for(h=-1;h<S+1;h++)for(v=-1;v<S+1;v++)B(v,h,r,1)||(d=A(v,h),r.push("1"===t[d]?1:0))}for(m=[],y=0;y<(S+2)*(S+2);y++)m.push(r[(S+2)*(S+2)-y-1]);for(g=0;g<(S+2)*(S+2);g++)m.push(r[2*(S+2)*(S+2)-g-1]);return e.next=12,this.evalModel(r);case 12:return k=e.sent,e.next=15,this.evalModel(m);case 15:for(b=e.sent,w=[],x=0;x<S*S;x++)w.push((k[x]+b[S*S-x-1])/2);if(E=[],_)for(j=0;j<S;j++)for(M=0;M<S;M++)R=A(j,M),E.push(w[R]);else E=w;for(H=0;H<S*S;H++)this.props.G.model_output[H]=E[H];return C="",e.abrupt("return",E);case 25:e.prev=25,e.t0=e.catch(0),console.error(e.t0);case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cellStyle",value:function(e){return null===this.props.G.cells[e]?"emptyStyle":"0"===this.props.G.cells[e]?"p1Style":"p2Style"}},{key:"cellText",value:function(e,t){return t?this.props.G.model_display[e]:""}},{key:"isActive",value:function(e){return!!this.props.isActive&&null===this.props.G.cells[e]}},{key:"render",value:function(){var e=this;if(this.props.ctx.gameover){var t=_?"0":"1";C=this.props.ctx.gameover.winner===t?"Player has won!":"Agent has won!"}for(var r={fill:"rgb(251, 41, 67)",stroke:"black",strokeWidth:.1},n={fill:"rgb(6, 154, 243)",stroke:"black",strokeWidth:.1},a={fill:"white",stroke:"black",strokeWidth:.1},i=[],o=0;o<S;o++)for(var s=function(t){var s=o+t*S;i.push(l.a.createElement(k.Hexagon,{id:s,key:s,onClick:function(){return e.onClick(s)},cellStyle:"p2Style"===e.cellStyle(s)?n:"p1Style"===e.cellStyle(s)?r:a,q:o,r:t,s:-o-t},l.a.createElement(k.Text,null,e.cellText(s,e.state.display_ratings))))},u=0;u<S;u++)s(u);for(var c=S*S,p=0;p<S;p++){var f=-1;i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:r,q:p,r:f,s:-p-f})),i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:n,q:f,r:p,s:-p-f})),f=S,i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:r,q:p,r:f,s:-p-f})),i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:n,q:f,r:p,s:-p-f}))}return l.a.createElement("div",null,l.a.createElement("div",{class:"intro"},"HexHex - A reinforcement deep learning agent by Simon Buchholz, David Harbecke, and Pascal Van Cleeff.",l.a.createElement("br",null),l.a.createElement("a",{href:"https://github.com/harbecke/hex"},"github.com/harbecke/hex")),l.a.createElement("div",{id:"winner"},C),l.a.createElement("div",{id:"controls"},l.a.createElement(q,{initial:!1,toggle:this.setDisplayRatings})),l.a.createElement("div",{className:"App"},l.a.createElement(k.HexGrid,{width:1e3,height:800,viewBox:"0 -3 30 30"},l.a.createElement(k.Layout,{size:{x:1,y:1},flat:!1,spacing:1},i))))}}]),r}(l.a.Component),F=Object(g.a)({game:D,board:T,debug:!1});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},53:function(e,t,r){e.exports=r(106)},58:function(e,t,r){},72:function(e,t,r){}},[[53,1,2]]]);
//# sourceMappingURL=main.a68ba157.chunk.js.map