(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{101:function(e,t){},105:function(e,t,r){"use strict";r.r(t);var n,a=r(0),l=r.n(a),i=r(48),o=r.n(i),s=(r(57),r(1)),u=r.n(s),c=r(4),f=r(5),p=r(13),h=r(17),v=r(15),d=r(23),m=r(16),y=r(3),g=r(50),k=r(6),b=r(25),w=r(11),x=r.n(w),S=(r(71),new b.InferenceSession),E="./11_2w4_1262.onnx",j=!1,C="",O=!0;function _(){return G.apply(this,arguments)}function G(){return(G=Object(y.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.loadModel(E);case 2:j=!0;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return e+11*t}function R(e){var t=e%11;return[t,(e-t)/11]}function H(e){if("red-bottom"===e)return x.a.range(110,121);if("red-top"===e)return x.a.range(0,11);if("blue-left"===e)return x.a.range(0,121,11);if("blue-right"===e)return x.a.range(10,121,11);var t=function(e){var t=R(e),r=Object(m.a)(t,2),n=r[0],a=r[1],l=[];return 0!==n&&l.push(A(n-1,a)),0!==n&&10!==a&&l.push(A(n-1,a+1)),0!==a&&l.push(A(n,a-1)),10!==a&&l.push(A(n,a+1)),10!==n&&0!==a&&l.push(A(n+1,a-1)),10!==n&&l.push(A(n+1,a)),l}(e),r=R(e),n=Object(m.a)(r,2),a=n[0],l=n[1];return 0===a&&t.push("blue-left"),10===a&&t.push("blue-right"),0===l&&t.push("red-top"),10===l&&t.push("red-bottom"),t}function M(e){var t=["red-top","blue-left"],r=["red-bottom","blue-right"];for(var n in x.a.range(2))for(var a=r[n],l=[t[n]],i=new Set;l.length>0;){var o,s=l.pop(),u=Object(d.a)(H(s));try{for(u.s();!(o=u.n()).done;){var c=o.value;if(c===a)return!0;"string"!==typeof c&&(e[c]!==n.toString()||i.has(c)||(l.push(c),i.add(c)))}}catch(f){u.e(f)}finally{u.f()}}return!1}var W=function(e){Object(h.a)(r,e);var t=Object(v.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state={showRatings:e.initial},n.handleClick=n.handleClick.bind(Object(p.a)(n)),n}return Object(f.a)(r,[{key:"handleClick",value:function(){this.props.toggle(!this.state.showRatings),this.setState((function(e){return{showRatings:!e.showRatings}}))}},{key:"render",value:function(){return l.a.createElement("button",{onClick:this.handleClick},this.state.showRatings?"Hide Ratings":"Show Ratings")}}]),r}(l.a.Component),q={setup:function(){return{cells:Array(121).fill(null),connected_sets:[[],[]],connected_set_rows:[[],[]],winner:null,model_output:Array(121).fill(null),model_display:Array(121).fill("")}},moves:{clickCell:function(e,t,r){if(1==e.cells.reduce((function(e,t){return e+(t?1:0)}),0)&&"0"==e.cells[r])O=!O,C="Switched!";else{var n=t.currentPlayer;O||(n="0"===t.currentPlayer?"1":"0"),e.cells[r]=n;var a=M(e.cells);e.last_move=r,a&&(e.winner=n)}}},endIf:function(e,t){if(null!==e.winner)return{winner:e.winner}},turn:{moveLimit:1},ai:{enumerate:function(e,t){for(var r=[],n=0;n<121;n++)null===e.cells[n]&&r.push({move:"clickCell",args:[n]});return r}}};function D(e,t,r,n){var a="0"===r?"1":"0";if(M(e))return"0"===r?[-1,null]:[1,null];if(0===t)return[0,null];if("0"===r){for(var l=-10,i=null,o=0;o<121;o++)if(null===e[o]){e[o]=r;var s=D(e,t-1,a,n);if(e[o]=null,s[0]>l&&(l=s[0],i=o),l>=1)return[l,i];if(r!==n&&0===l)return[l,i]}return[l,i]}for(var u=10,c=null,f=0;f<121;f++)if(null===e[f]){e[f]=r;var p=D(e,t-1,a,n);if(e[f]=null,p[0]<u){if(c=f,(u=p[0])<=-1)return[u,c];if(r!==n&&0===u)return[u,c]}}return[u,c]}var P=function(e){Object(h.a)(r,e);var t=Object(v.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).setDisplayRatings=n.setDisplayRatings.bind(Object(p.a)(n)),n.state={display_ratings:!1},n}return Object(f.a)(r,[{key:"findSureWinMove",value:function(e,t){for(var r=0,n=[1,3];r<n.length;r++){var a=D(e,n[r],t,t);if("0"===t){if(a[0]>0)return a[1]}else if(a[0]<0)return a[1]}return null}},{key:"onClick",value:function(e){var t=this;if(this.isActive(e)){var r=O?"0":"1",a=O?"1":"0",l=Array.from(this.props.G.cells);if(l[e]=r,this.props.moves.clickCell(e),!M(l)){var i=this.findSureWinMove(l,a);if(null===i)this.runModel(l).then((function(l){for(var i=t.props.G.cells.reduce((function(e,t){return e+(t?1:0)}),0),o=-1,s=0;s<121;s++)(i<=1||null===t.props.G.cells[s])&&(-1===o||l[s]>n)&&(o=s,n=l[s]);for(var u=0;u<121;u++){if(i<=1||null===t.props.G.cells[u])Math.pow(2,l[u]-n)}for(var c=0;c<121;c++)if(i<=1||null===t.props.G.cells[c]){Math.pow(2,l[c]-n);t.props.G.model_display[c]=l[c].toFixed(1)}else t.props.G.model_display[c]="";var f=Array.from(t.props.G.cells);f[e]=r,f[o]=a;var p=t.findSureWinMove(f,r);null!==p&&(console.log("Player can surely win with the suggested move",o,"Moving to the sure win move instead."),o=p),t.props.moves.clickCell(o)}));else{console.log("Found sure win move",i),this.props.moves.clickCell(i);for(var o=0;o<121;o++)this.props.G.model_display[o]=""}}}}},{key:"setDisplayRatings",value:function(e){this.setState({display_ratings:e})}},{key:"runModel",value:function(){var e=Object(y.a)(u.a.mark((function e(t){var r,n,a,l,i,o,s,c,f,p,h,v,d,m,y,g,k,w,x,E,G,R,H,M,W,q,D;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C="waiting for agent to move...",j){e.next=5;break}return e.next=5,_();case 5:if(r=[],O){for(n=0;n<11;n++)for(a=0;a<11;a++)l=A(n,a),r.push("1"===t[l]?1:0);for(i=0;i<11;i++)for(o=0;o<11;o++)s=A(i,o),r.push("0"===t[s]?1:0)}else{for(c=0;c<11;c++)for(f=0;f<11;f++)p=A(f,c),r.push("0"===t[p]?1:0);for(h=0;h<11;h++)for(v=0;v<11;v++)d=A(v,h),r.push("1"===t[d]?1:0)}for(m=[],y=0;y<121;y++)m.push(r[121-y-1]);for(g=0;g<121;g++)m.push(r[242-g-1]);return k=[new b.Tensor(new Float32Array(r),"float32",[1,2,11,11])],w=[new b.Tensor(new Float32Array(m),"float32",[1,2,11,11])],e.next=14,S.run(k);case 14:return x=e.sent,e.next=17,S.run(w);case 17:if(E=e.sent,G=x.values().next().value,R=E.values().next().value,H=[],O)for(M=0;M<11;M++)for(W=0;W<11;W++)q=A(M,W),H.push((G.data[q]+R.data[121-q-1])/2);else H=G.data;for(D=0;D<121;D++)this.props.G.model_output[D]=H[D];return C="",e.abrupt("return",H);case 27:e.prev=27,e.t0=e.catch(0),console.error(e.t0);case 30:case"end":return e.stop()}}),e,this,[[0,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cellStyle",value:function(e){return null===this.props.G.cells[e]?"emptyStyle":"0"===this.props.G.cells[e]?"p1Style":"p2Style"}},{key:"cellText",value:function(e,t){return t?this.props.G.model_display[e]:""}},{key:"isActive",value:function(e){return!!this.props.isActive&&null===this.props.G.cells[e]}},{key:"render",value:function(){var e=this;if(this.props.ctx.gameover){var t=O?"0":"1";C=this.props.ctx.gameover.winner===t?"Player has won!":"Agent has won!"}for(var r={fill:"rgb(251, 41, 67)",stroke:"black",strokeWidth:.1},n={fill:"rgb(6, 154, 243)",stroke:"black",strokeWidth:.1},a={fill:"white",stroke:"black",strokeWidth:.1},i=[],o=0;o<11;o++)for(var s=function(t){var s=o+11*t;i.push(l.a.createElement(k.Hexagon,{id:s,key:s,onClick:function(){return e.onClick(s)},cellStyle:"p2Style"===e.cellStyle(s)?n:"p1Style"===e.cellStyle(s)?r:a,q:o,r:t,s:-o-t},l.a.createElement(k.Text,null,e.cellText(s,e.state.display_ratings))))},u=0;u<11;u++)s(u);for(var c=121,f=0;f<11;f++){var p=-1;i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:r,q:f,r:p,s:-f-p})),i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:n,q:p,r:f,s:-f-p})),p=11,i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:r,q:f,r:p,s:-f-p})),i.push(l.a.createElement(k.Hexagon,{key:c++,cellStyle:n,q:p,r:f,s:-f-p}))}return l.a.createElement("div",null,l.a.createElement("div",{class:"intro"},"HexHex - A reinforcement deep learning agent by Simon Buchholz, David Harbecke, and Pascal Van Cleeff.",l.a.createElement("br",null),l.a.createElement("a",{href:"https://github.com/harbecke/hex"},"github.com/harbecke/hex")),l.a.createElement("div",{id:"winner"},C),l.a.createElement("div",{id:"controls"},l.a.createElement(W,{initial:!1,toggle:this.setDisplayRatings})),l.a.createElement("div",{className:"App"},l.a.createElement(k.HexGrid,{width:1e3,height:800,viewBox:"0 -3 30 30"},l.a.createElement(k.Layout,{size:{x:1,y:1},flat:!1,spacing:1},i))))}}]),r}(l.a.Component),T=Object(g.a)({game:q,board:P,debug:!1});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},52:function(e,t,r){e.exports=r(105)},57:function(e,t,r){},71:function(e,t,r){}},[[52,1,2]]]);
//# sourceMappingURL=main.f5ec8056.chunk.js.map