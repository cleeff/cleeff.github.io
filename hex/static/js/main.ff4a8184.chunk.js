(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{103:function(e,t,r){"use strict";r.r(t);var n,a=r(0),l=r.n(a),s=r(47),i=r.n(s),o=(r(56),r(1)),c=r.n(o),u=r(5),p=r(6),f=r(13),h=r(17),v=r(15),y=r(3),d=r(16),m=r(4),g=r(49),w=r(7),k=r(23),S=(r(69),new k.InferenceSession),b="./11_2w4_1262.onnx",O=!1,x="",_=!0;function j(){return E.apply(this,arguments)}function E(){return(E=Object(m.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.loadModel(b);case 2:O=!0;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return e+11*t}function J(e){var t=e%11;return[t,(e-t)/11]}function N(e,t,r,n){for(var a=J(r),l=Object(d.a)(a,2),s=l[0],i=l[1],o=new Set([r]),c="0"===n?new Set([i]):new Set([s]),u=new Set(function(e){var t=J(e),r=Object(d.a)(t,2),n=r[0],a=r[1],l=[];return 0!==n&&l.push(A(n-1,a)),0!==n&&10!==a&&l.push(A(n-1,a+1)),0!==a&&l.push(A(n,a-1)),10!==a&&l.push(A(n,a+1)),10!==n&&0!==a&&l.push(A(n+1,a-1)),10!==n&&l.push(A(n+1,a)),l}(r)),p=0;p<e[n].length;p++){var f=new Set(e[n][p]),h=new Set(t[n][p]);new Set(Object(y.a)(f).filter((function(e){return u.has(e)}))).size>0&&(o=new Set([].concat(Object(y.a)(o),Object(y.a)(f))),c=new Set([].concat(Object(y.a)(c),Object(y.a)(h))))}return e[n].push(Array.from(o)),t[n].push(Array.from(c)),c.has(0)&&c.has(10)}Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]});var C=function(e){Object(h.a)(r,e);var t=Object(v.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).state={showRatings:e.initial},n.handleClick=n.handleClick.bind(Object(f.a)(n)),n}return Object(p.a)(r,[{key:"handleClick",value:function(){this.props.toggle(!this.state.showRatings),this.setState((function(e){return{showRatings:!e.showRatings}}))}},{key:"render",value:function(){return l.a.createElement("button",{onClick:this.handleClick},this.state.showRatings?"Hide Ratings":"Show Ratings")}}]),r}(l.a.Component),G={setup:function(){return{cells:Array(121).fill(null),connected_sets:[[],[]],connected_set_rows:[[],[]],winner:null,model_output:Array(121).fill(null),model_display:Array(121).fill("")}},moves:{clickCell:function(e,t,r){if(1==e.cells.reduce((function(e,t){return e+(t?1:0)}),0)&&"0"==e.cells[r])_=!_,x="Switched!";else{var n=t.currentPlayer;_||(n="0"===t.currentPlayer?"1":"0"),e.cells[r]=n;var a=N(e.connected_sets,e.connected_set_rows,r,n);e.last_move=r,a&&(e.winner=n)}}},endIf:function(e,t){if(null!==e.winner)return{winner:e.winner}},turn:{moveLimit:1},ai:{enumerate:function(e,t){for(var r=[],n=0;n<121;n++)null===e.cells[n]&&r.push({move:"clickCell",args:[n]});return r}}};var R=function(e){Object(h.a)(r,e);var t=Object(v.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).setDisplayRatings=n.setDisplayRatings.bind(Object(f.a)(n)),n.state={display_ratings:!1},n}return Object(p.a)(r,[{key:"findSureWinMove",value:function(e,t,r){var n=function e(t,r,n,a,l){var s=_?"0":"1",i=_?"1":"0";if(0===a)return[0,null];if(l){for(var o=-10,c=null,u=0;u<121;u++){if(null===t[u])if(N(JSON.parse(JSON.stringify(r)),JSON.parse(JSON.stringify(n)),u,i))return[1,u]}for(var p=0;p<121;p++)if(null===t[p]){var f=Array.from(t),h=JSON.parse(JSON.stringify(r)),v=JSON.parse(JSON.stringify(n));f[p]="x";var y=e(f,h,v,a-1,!1);if(y[0]>o&&(o=y[0],c=p),o>=1)return[o,c]}return[o,c]}for(var d=10,m=null,g=0;g<121;g++)if(null===t[g]){var w=Array.from(t),k=JSON.parse(JSON.stringify(r)),S=JSON.parse(JSON.stringify(n));if(w[g]="p",N(k,S,g,s))return[-1,g];var b=e(w,k,S,a-1,!0);if(b[0]<d&&(m=g,(d=b[0])<=0))return[d,m]}return[d,m]}(e,t,r,3,!0);return n[0]>0?n[1]:null}},{key:"onClick",value:function(e){var t=this;if(this.isActive(e)){var r=_?"0":"1",a=Array.from(this.props.G.cells);a[e]=r,this.props.moves.clickCell(e);var l=JSON.parse(JSON.stringify(this.props.G.connected_sets)),s=JSON.parse(JSON.stringify(this.props.G.connected_set_rows));if(!N(l,s,e,r)){var i=this.findSureWinMove(a,l,s);if(null===i)this.runModel(a).then((function(e){for(var r=t.props.G.cells.reduce((function(e,t){return e+(t?1:0)}),0),a=-1,l=0;l<121;l++)(r<=1||null===t.props.G.cells[l])&&(-1===a||e[l]>n)&&(a=l,n=e[l]);for(var s=0;s<121;s++){if(r<=1||null===t.props.G.cells[s])Math.pow(2,e[s]-n)}for(var i=0;i<121;i++)if(r<=1||null===t.props.G.cells[i]){Math.pow(2,e[i]-n);t.props.G.model_display[i]=e[i].toFixed(1)}else t.props.G.model_display[i]="";t.props.moves.clickCell(a)}));else{console.log("Found sure win move",i),this.props.moves.clickCell(i);for(var o=0;o<121;o++)this.props.G.model_display[o]=""}}}}},{key:"setDisplayRatings",value:function(e){this.setState({display_ratings:e})}},{key:"runModel",value:function(){var e=Object(m.a)(c.a.mark((function e(t){var r,n,a,l,s,i,o,u,p,f,h,v,y,d,m,g,w,b,E,J,N,C,G,R,H,M,W;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x="waiting for agent to move...",O){e.next=5;break}return e.next=5,j();case 5:if(r=[],_){for(n=0;n<11;n++)for(a=0;a<11;a++)l=A(n,a),r.push("1"===t[l]?1:0);for(s=0;s<11;s++)for(i=0;i<11;i++)o=A(s,i),r.push("0"===t[o]?1:0)}else{for(u=0;u<11;u++)for(p=0;p<11;p++)f=A(p,u),r.push("0"===t[f]?1:0);for(h=0;h<11;h++)for(v=0;v<11;v++)y=A(v,h),r.push("1"===t[y]?1:0)}for(d=[],m=0;m<121;m++)d.push(r[121-m-1]);for(g=0;g<121;g++)d.push(r[242-g-1]);return w=[new k.Tensor(new Float32Array(r),"float32",[1,2,11,11])],b=[new k.Tensor(new Float32Array(d),"float32",[1,2,11,11])],e.next=14,S.run(w);case 14:return E=e.sent,e.next=17,S.run(b);case 17:if(J=e.sent,N=E.values().next().value,C=J.values().next().value,G=[],_)for(R=0;R<11;R++)for(H=0;H<11;H++)M=A(R,H),G.push((N.data[M]+C.data[121-M-1])/2);else G=N.data;for(W=0;W<121;W++)this.props.G.model_output[W]=G[W];return x="",e.abrupt("return",G);case 27:e.prev=27,e.t0=e.catch(0),console.error(e.t0);case 30:case"end":return e.stop()}}),e,this,[[0,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cellStyle",value:function(e){return null===this.props.G.cells[e]?"emptyStyle":"0"===this.props.G.cells[e]?"p1Style":"p2Style"}},{key:"cellText",value:function(e,t){return t?this.props.G.model_display[e]:""}},{key:"isActive",value:function(e){return!!this.props.isActive&&null===this.props.G.cells[e]}},{key:"render",value:function(){var e=this;if(this.props.ctx.gameover){var t=_?"0":"1";x=this.props.ctx.gameover.winner===t?"Player has won!":"Agent has won!"}for(var r={fill:"rgb(251, 41, 67)",stroke:"black",strokeWidth:.1},n={fill:"rgb(6, 154, 243)",stroke:"black",strokeWidth:.1},a={fill:"white",stroke:"black",strokeWidth:.1},s=[],i=0;i<11;i++)for(var o=function(t){var o=i+11*t;s.push(l.a.createElement(w.Hexagon,{id:o,key:o,onClick:function(){return e.onClick(o)},cellStyle:"p2Style"===e.cellStyle(o)?n:"p1Style"===e.cellStyle(o)?r:a,q:i,r:t,s:-i-t},l.a.createElement(w.Text,null,e.cellText(o,e.state.display_ratings))))},c=0;c<11;c++)o(c);for(var u=121,p=0;p<11;p++){var f=-1;s.push(l.a.createElement(w.Hexagon,{key:u++,cellStyle:r,q:p,r:f,s:-p-f})),s.push(l.a.createElement(w.Hexagon,{key:u++,cellStyle:n,q:f,r:p,s:-p-f})),f=11,s.push(l.a.createElement(w.Hexagon,{key:u++,cellStyle:r,q:p,r:f,s:-p-f})),s.push(l.a.createElement(w.Hexagon,{key:u++,cellStyle:n,q:f,r:p,s:-p-f}))}return l.a.createElement("div",null,l.a.createElement("div",{class:"intro"},"HexHex - A reinforcement deep learning agent by Simon Buchholz, David Harbecke, and Pascal Van Cleeff.",l.a.createElement("br",null),l.a.createElement("a",{href:"https://github.com/harbecke/hex"},"github.com/harbecke/hex")),l.a.createElement("div",{id:"winner"},x),l.a.createElement("div",{id:"controls"},l.a.createElement(C,{initial:!1,toggle:this.setDisplayRatings})),l.a.createElement("div",{className:"App"},l.a.createElement(w.HexGrid,{width:1e3,height:800,viewBox:"0 -3 30 30"},l.a.createElement(w.Layout,{size:{x:1,y:1},flat:!1,spacing:1},s))))}}]),r}(l.a.Component),H=Object(g.a)({game:G,board:R,debug:!1});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},51:function(e,t,r){e.exports=r(103)},56:function(e,t,r){},69:function(e,t,r){},99:function(e,t){}},[[51,1,2]]]);
//# sourceMappingURL=main.ff4a8184.chunk.js.map